# Dendropark PostGIS
Скрипты PostGIS для оценки качества данных [OSM](https://osm.org), [WikiMap](https://commons.wikimedia.org/wiki/Category:Biryulyovskiy_Arboretum), [PastVu](https://pastvu.com/ps?f=r!7395), [Википедии](https://ru.wikipedia.org/wiki/Бирюлёвский_дендрарий) по [Бирюлёвскому дендропарку](https://www.openstreetmap.org/relation/5851116).

**Данный программный продукт не предназначен для Windows или WSL и полностью не работоспособен в этой группе ОС**.

## Подготовка базы данных
1. Установите любую версию PostgreSQL 9+ и преобразователь данных [osmium](https://github.com/joto/osmium). Например, из пакетов deb используя программу `apt`. Типичные названия пакетов `postgresql-18` и `osmium-tool` соотвественно.
2. Создайте пользователя и базу данных для размещения геоданных
```bash
sudo -u postgres bash;
psql
```
Вы можете выбрать любые имена, например:
```sql
CREATE USER "Геоинформатик" LOGIN PASSWORD 'password';
CREATE DATABASE "Геоинформационная система" OWNER "Геоинформатик";
\q
```

3. Создайте расширение PostGIS и другие
Убедитесь что расширение http доступно. Оно содержится в пакете ОС с названием вроде `postgresql-**-contrib` или `posrtgresql-**-http` для Вашей версии PostgreSQL.
```bash
psql -d "Геоинформационная система"
```
SQL от администратора всех БД
```
CREATE EXTENSION postgis;
CREATE EXTENSION http;
CREATE EXTENSION file_fdw;

CREATE SERVER "Wiki дендропарк" FOREIGN DATA WRAPPER file_fdw;
grant usage on foreign server "Wiki дендропарк" to "Геоинформатик";
grant pg_execute_server_program to "Геоинформатик";
```

4. Проверьте доступность пространственных типов данных и функций
```sql
select postgis_version();
```
5. Выйдите из терминала БД и административного режима

## Подготовка объектов пространственной аналитики и работа с ними

6. Войдите терминале ОС в каталог данного репозитория
```bash
cd Dendropark-PostGIS
```
7. Создайте таблицы и представления пространственной аналитики, указав нужного Вам пользователя и название БД для геофинормационных работ
```bash
cat 0\ Создание\ базовых\ структур.sql | psql -d "Геоинформационная система" -U "Геоинформатик";
```
8. Выбирете активный каталог для ведения архива первичных данных. Оттуда будут вызываться программы. Программы всегда откладывают архивы в активном каталоге на момент из вызова.

9. Настройте своё название БД и имя пользователя в файле текстовом *postgres.url* в выбранном каталоге. Правила написания строки доступа к БД см. в [официальной документации](https://postgrespro.ru/docs/postgresql/18/libpq-connect#LIBPQ-CONNSTRING).

10. Вызовите скрипт для первичного заполнения данных `OSM Дендропарк.sh`. В активном каталоге будут откладываться архивы первичных файлов-документов OSM XML, Wikimedia JOSN и PastVuJSON.

11. Осматривайте представления и создавайте новые!

12. Обновляйте данные таким же вызовом скриптов как в п.10.

### Параметры вызова в скрипте `OSM Дендропарк.sh`

1. Граница скачивания bbox
2. Название схемы для объектов Бирюлёвского дендропарка, всегда `'Бирюлёвский дендропарк'`
